(()=>{var e={1160:(e,t,r)=>{const a=r(6860),o=r(9470);r(5142).config();const s=r(1017),i=r(1208),c=r(2373),n=r(9710),d=r(2457),l=r(5526),u=r(7738),p=r(3e3),g=r(1810),m=r(4162),y=r(2274),P=r(3767),w=r(7598),h=r(2357),f=r(8011),E=r(6508);e.exports=class{constructor(e){this.app=a(),this.port=e,this.middleware(),this.settings(),this.router()}middleware(){this.app.use(o("dev")),this.app.use(a.static(s.join(__dirname,"public"))),this.app.use(n()),this.app.use(a.json()),this.app.use(a.urlencoded({extended:!1})),this.app.use(E({secret:process.env.SESSION_SECRET,resave:!1,saveUninitialized:!0,cookie:{secure:!1}}))}settings(){this.app.set("view engine","ejs"),this.app.set("views",s.join(__dirname,"views"))}router(){this.app.use(i),this.app.use(c),this.app.use(l),this.app.use(c),this.app.use(u),this.app.use(p),this.app.use(g),this.app.use(m),this.app.use(y),this.app.use(P),this.app.use(w),this.app.use(h),this.app.use(f),this.app.use(((e,t)=>t.send("pagina no encotrada")))}start(){this.app.listen(this.port,(async()=>{await d(),console.log(`server on port ${this.port}`)}))}}},3894:(e,t,r)=>{const a=r(8205),o=r(441),s=r(9418),i=r(8941),c=r(4863);e.exports=class{static async Administration(e,t){const r=e.user.firstName,n=e.user.lastName,d=e.user.email,l=e.user.nameRole,u=await s.getAllProduct(),p=await o.showCategory(),g=await i.getSales(),m=await a.getAllOrder({state:0}),y=await c.getUser();return t.render("adminstracionPanel",{products:u.length,categories:p.length,sales:g.length,order:m.length,user:y.length,nombreUser:r,emailUser:d,apellidoUser:n,rolUser:l})}}},7485:(e,t,r)=>{const{validationResult:a}=r(3553),o=r(5698),s=r(7096),i=r(9344);e.exports=class{static async login(e,t){const r=a(e);if(!r.isEmpty())return t.render("login",{errors:r.array(),alertMsg:""});try{const{email:r,password:a}=e.body,c=await o.login({email:r});if(0===c.length){const e="La cuenta no existe";return t.render("login",{errors:[],alertMsg:e})}if(r===c[0].email&&await s.compare(a,c[0].password)){const e=i.sign({idUser:c[0].idUser},process.env.JWT_SECRET);return t.cookie("jwt",e,{httpOnly:!0,sameSite:"strict",maxAge:36e5}),t.redirect("/administration-panel")}{const e="ContraseÃ±a incorrecta";return t.render("login",{errors:[],alertMsg:e})}}catch(e){console.log(e)}}static formLogin(e,t){return t.render("login",{errors:[],alertMsg:""})}static logout(e,t){return t.clearCookie("jwt"),t.redirect("/login")}}},6327:(e,t,r)=>{const a=r(2187);e.exports=class{static DeleteObjet(e,t){const r={};return e.filter((e=>{const a=e[t];return!r[a]&&(r[a]=!0,!0)}))}static async searchProduct(e){let t=[];for(let r of e){const e=await a.cardProduct({productId:r});t.push(...e)}return t}static totalPrice(e){let t=0;for(let r=0;r<e.length;r++)t+=parseFloat(e[r].price);return t.toFixed(2)}static catidadProduct(e){let t={};return e.forEach((e=>{const r=e.idProduct;t[r]=(t[r]||0)+1})),t}static async getProdcut(e){const t=[];let r,a=0;try{const o=await this.searchProduct(e);t.push(...o);const s=this.totalPrice(t);r=this.DeleteObjet(o,"idProduct"),a=s;const i=this.catidadProduct(t);return t.forEach((e=>{const t=e.idProduct;e.cantidad=i[t]||1})),{productUnique:r,totalPrice:a}}catch(e){console.log(e)}}}},5663:(e,t,r)=>{const a=r(6327),o=r(441),s=new class{addCart(e,t){const{idCart:r}=e.params;return e.session.idProduct||(e.session.idProduct=[]),e.session.idProduct.push(r),t.redirect("/cart")}async cart(e,t){let r,s;const i=[];try{const c=await o.showCategory();if(e.session.idProduct){r=await a.getProdcut(e.session.idProduct);for(let e of r.productUnique)e.cantidad>e.amount&&(s={prodcut:e.nameProduct,cantidadMaxima:e.amount},i.push(s));return t.render("cart",{product:r.productUnique,totalPrice:r.totalPrice,categories:c,maximoProduct:i})}return t.render("cart",{product:"",totalPrice:"",categories:c})}catch(e){console.log(e)}}deleteCartProduct(e,t){const{idProduct:r}=e.params;if(e.session.idProduct&&e.session.idProduct.length>0){const t=e.session.idProduct.findIndex((e=>e==r));-1!=t&&e.session.idProduct.splice(t,1)}return t.redirect("/cart")}};e.exports=s},386:(e,t,r)=>{const a=r(9418),o=r(441),s=r(3518),i=r(1017),c=r(7147),{validationResult:n}=r(3553),d=new class{constructor(){s.config({cloud_name:process.env.CLOUD_NAME,api_key:process.env.CLOUD_API_KEY,api_secret:process.env.CLOUD_API_SECRET})}async showProduct(e,t){try{let{nameProduct:r}=e.params;const o=await a.getProductCategory({nameProduct:r});return t.render("category",{product:o.product,category:o.category,categories:o.category})}catch(e){console.log(e)}}async categoryPanel(e,t){const r=e.user.firstName,a=e.user.lastName,s=e.user.email,i=e.user.nameRole,c=e.query.CategoriAdd,n=e.query.mensajeDelete,d=e.query.CategoriaDuplicada;try{const e=await o.showCategory();return t.render("categoriasPanel",{categories:e,mensaje:"",valuesbody:"",error:[],categoriaMsg:c,categoriaDeleteMsg:n,categoriaDuplicada:d,nombreUser:r,apellidoUser:a,emailUser:s,rolUser:i})}catch(e){console.log(e)}}async addCategory(e,t){const r=n(e),{categoria:a}=e.body,d=e.file;try{if(!r.isEmpty()){const a=e.body,s=await o.showCategory();return t.render("categoriasPanel",{categories:s,mensaje:"",valuesbody:a,error:r.array(),categoriaMsg:"",categoriaDeleteMsg:"",categoriaDuplicada:""})}const i=await s.v2.uploader.upload(d.path);return"ER_DUP_ENTRY"===(await o.addCategory(a,i.secure_url,i.public_id)).code?t.redirect("/category-panel?CategoriaDuplicada=true"):t.redirect("/category-panel?CategoriAdd=true")}catch(e){console.log(e)}finally{c.existsSync(i.join(__dirname+`../../public/upload/${d.filename}`))&&c.unlinkSync(i.join(__dirname+`../../public/upload/${d.filename}`))}}async deleteCategory(e,t){const r=e.user.firstName,a=e.user.lastName,i=e.user.email,c=e.user.nameRole,{idCategory:n,idImagen:d}=e.params;try{if(await o.deleteCategory(n)){const e="Hay productos en las categorias",s=await o.showCategory();return t.render("categoriasPanel",{categories:s,mensaje:e,valuesbody:"",error:[],categoriaMsg:"",categoriaDeleteMsg:"",categoriaDuplicada:"",nombreUser:r,apellidoUser:a,emailUser:i,rolUser:c})}return await s.v2.uploader.destroy(d),t.redirect("/category-panel?mensajeDelete=true")}catch(e){console.log(e)}}async updateCategoryForm(e,t){const r=e.user.firstName,a=e.user.lastName,s=e.user.email,i=e.user.nameRole,{idCategory:c}=e.params,n=e.query.mensaje;try{const e=await o.getCategoryId(c);return t.render("updateCategoria",{categoriasId:e,mensaje:n,nombreUser:r,apellidoUser:a,emailUser:s,rolUser:i})}catch(e){console.log(e)}}async updateCategory(e,t){const{idCategory:r}=e.params,{categoria:a}=e.body,d=e.file,l=n(e);try{const e=await o.getCategoryId(r);if(!l.isEmpty())return t.render("updateCategoria",{categoriasId:e});if("object"==typeof d){const t=await s.v2.uploader.upload(d.path),a=t.secure_url,n=t.public_id;await o.updateCategoryImage({idCategory:r,image:a,idImg:n}),await e.map((e=>s.v2.uploader.destroy(e.imageId))),c.existsSync(i.join(__dirname+`../../public/upload/${d.filename}`))&&c.unlinkSync(i.join(__dirname+`../../public/upload/${d.filename}`))}return await o.updateCategory({categoria:a,idCategory:r}),t.redirect(`/update-category/${r}?mensaje=true`)}catch(e){console.log(e)}}};e.exports=d},7400:(e,t,r)=>{const a=r(441);e.exports=class{static async contacto(e,t){const r=await a.showCategory();return t.render("contacto",{categories:r})}}},348:(e,t,r)=>{const a=r(441),o=r(9418),s=new class{async index(e,t){try{const e=await o.productDestacado(),r=await a.showCategory();return t.render("index",{product:e,categories:r})}catch(e){console.log(e)}}cartCantidad(e,t){let r;return r=Array.isArray(e.session.idProduct)?e.session.idProduct:0,t.json({cantidaCart:r})}portadaIndex(e,t){return t.render("portada")}};e.exports=s},4012:(e,t,r)=>{const a=r(441);e.exports=class{static async nosotros(e,t){const r=await a.showCategory();return t.render("nosotros",{categories:r})}}},6907:(e,t,r)=>{const a=r(8205),o=r(6327),{validationResult:s}=r(3553),i=r(441);r(6860),e.exports=class{static async pedido(e,t){const r=[];try{const a=await i.showCategory();if(e.session.idProduct){let s=await o.getProdcut(e.session.idProduct);return console.log(s.productUnique),t.render("pedidoForm",{products:s.productUnique,val:"",totalPrice:s.totalPrice,error:r,categories:a})}return t.send("productos vasios")}catch(r){}}static async pedidoFinal(e,t){const{nombre:r,apellidos:c,celular:n,Ciudad:d,direccion:l}=e.body,u={recoger:(e.body.recoger,0),entrega:"on"===e.body.entrega?1:0},p=c.split(" "),g=`https://api.whatsapp.com/send?phone=${process.env.TELEFONO_TIENDA}&text=Ponte en contacto directo con nosotros?`,m=s(e);if(!m.isEmpty()){const r=m.array(),a=e.body;if(e.session.idProduct){const s=await i.showCategory();let c=await o.getProdcut(e.session.idProduct);return t.render("pedidoForm",{products:c.productUnique,val:a,totalPrice:c.totalPrice,error:r,categories:s})}}try{if(e.session.idProduct){let s=await o.getProdcut(e.session.idProduct);return console.log(s),"45000"==(await a.Pedido({nombre:r,lastName:p,celular:n,Ciudad:d,direccion:l,product:s,orderP:u})).sqlState?t.send("catidad execiva"):t.redirect(g)}return t.send("nada ")}catch(e){console.log(e),console.log(e)}}static async getAllOrder(e,t){const r=e.user.firstName,o=e.user.lastName,s=e.user.email,i=e.user.nameRole,c=e.query.mensaje;console.log(c);try{if(c){const e=await a.getAllOrder({state:0});return t.render("pedidoPanel",{pedido:e,mensaje:c,nombreUser:r,apellidoUser:o,emailUser:s,rolUser:i})}const e=await a.getAllOrder({state:0});return console.log(e),t.render("pedidoPanel",{pedido:e,mensaje:"",nombreUser:r,apellidoUser:o,emailUser:s,rolUser:i})}catch(e){console.log(e)}}static async stateOrder(e,t){const{idOrder:r}=e.params;try{return await a.productEntregado({idOrder:r,state:1}),t.redirect("/get-order?mensaje=vender")}catch(e){console.log(e)}}static async deteleOrder(e,t){const{idPersonOrder:r}=e.params;console.log(r);try{return await a.deletePorductId({idPersonOrder:r}),t.redirect("/get-order?mensaje=eliminar")}catch(e){console.log(e)}}}},9202:(e,t,r)=>{const{validationResult:a}=r(3553),o=r(9418),s=r(441),i=r(3518),c=r(1017),{promisify:n}=r(3837),d=r(7147),l=new class{constructor(){this.data=[],this.productPanel=[],this.newProdcut=!1,i.config({cloud_name:process.env.CLOUD_NAME,api_key:process.env.CLOUD_API_KEY,api_secret:process.env.CLOUD_API_SECRET})}async formProduct(e,t){const r=e.user.firstName,a=e.user.lastName,o=e.user.email,i=e.user.nameRole,c="true"===e.query.mensaje,n=await s.showCategory();return t.render("formProductPanel",{values:[],error:[],categories:n,productoAgregado:c,categories:n,nombreUser:r,apellidoUser:a,emailUser:o,rolUser:i})}async addProduct(e,t){e.user.firstName,e.user.lastName,e.user.email,e.user.nameRole;const r=e.files;let n=[];const l=a(e);try{if(!l.isEmpty()){const r=e.body,a=await s.showCategory();return t.render("formProductPanel",{error:l.array(),values:r,categories:a,productoAgregado:!1})}const{nombre:a,cantidad:c,colores:d,descripcion:u,tallas:p,categorias:g,precio:m}=e.body,y="1"===e.body.destacado?1:0;for(let e of r){const t=await i.v2.uploader.upload(e.path);let r={};r.urlImg=t.secure_url,r.idImg=t.public_id,n.push(r)}return await o.addPorduct({nombre:a,descripcion:u,cantidad:c,precio:m,colores:d,tallas:p,pathImgCloud:n,categorias:g,destacado:y}),t.redirect("/add-product?mensaje=true")}catch(e){console.log(e)}finally{for(let e of r)d.existsSync(c.join(__dirname+`../../public/upload/${e.filename}`))&&d.unlinkSync(c.join(__dirname+`../../public/upload/${e.filename}`))}}async descriptionProduct(e,t){const{idProduct:r}=e.params;try{const e=await s.showCategory(),a=await o.descriptionProduct({idProduct:r});return t.render("descriptionProduct",{product:a,categories:e})}catch(e){console.log(e)}}async getProductAllPanel(e,t){const r=e.user.firstName,a=e.user.lastName,s=e.user.email,i=e.user.nameRole,c="true"===e.query.mensaje;try{let e=[];const n=await o.getAllProduct();return console.log(n),t.render("productPanel",{error:e,values:"",product:n,mensaje:c,nombreUser:r,apellidoUser:a,emailUser:s,rolUser:i})}catch(e){console.log(e)}}async deleteProduct(e,t){try{const{idProduct:r}=e.params,a=await o.deleteProduct({idProduct:r});if(1451===a)return t.redirect("/products-panel?mensaje=true");if(a)for(let e of a)await i.v2.uploader.destroy(e.imagenId);return t.redirect("/products-panel")}catch(e){console.log(e)}}async formUpdateProdcut(e,t){const r=e.user.firstName,a=e.user.lastName,i=e.user.email,c=e.user.nameRole,{idProduct:n}=e.params,d=e.query.mensaje;let l=[];const u=[];let p={};try{const e=await o.getAllProductId({idProduct:n}),g=await s.showCategory();for(let t of g)t.idCategory==e.productos[0].idCategory&&(p.idCategory=t.idCategory,p.nombreCategoria=t.nameCategory,u.push(p));return t.render("formProductPanelUpdate",{product:e.productos,img:e.dataImgPro,values:l,error:[],categories:g,categoriaP:u,mensaje:d,nombreUser:r,apellidoUser:a,emailUser:i,rolUser:c})}catch(e){}}async updateProduct(e,t){const r=a(e),n=[];let l=[],u={};const{idProduct:p}=e.params,g=e.files;try{const a=await o.getAllProductId({idProduct:p});if(!r.isEmpty()){const e=await s.showCategory();for(let t of e)t.idCategory==a.productos[0].idCategory&&(u.idCategory=t.idCategory,u.nombreCategoria=t.nameCategory,n.push(u));return t.render("formProductPanelUpdate",{error:r.array(),product:a.productos,img:a.dataImgPro,categories:e,categoriaP:n})}const{nombre:c,cantidad:d,colores:m,descripcion:y,tallas:P,categorias:w,precio:h}=e.body,f="1"===e.body.destacado?1:0;if(g.length>0){let e=a.dataImgPro.map((e=>e.imagenId));const t=[];for(let e of g){const r=await i.v2.uploader.upload(e.path),a={};a.urlImage=r.secure_url,a.idImg=r.public_id,l.push(a),t.push(r.public_id)}let r=e.filter((e=>!t.includes(e)));await r.map((e=>i.v2.uploader.destroy(e))),await o.updateImage({pathImgCloud:l,idProduct:p})}return await o.updateProduct({nombre:c,descripcion:y,cantidad:d,precio:h,colores:m,tallas:P,categorias:w,destacado:f,idProduct:p}),t.redirect(`/update-product/${p}?mensaje=true`)}catch(e){console.log(e)}finally{for(let e of g)d.existsSync(c.join(__dirname+`../../public/upload/${e.filename}`))&&d.unlinkSync(c.join(__dirname+`../../public/upload/${e.filename}`))}}};e.exports=l},1468:(e,t,r)=>{const a=r(8941);e.exports=class{constructor(){this.data=[]}static async getSales(e,t){const r=e.query.mensaje,o=e.user.firstName,s=e.user.lastName,i=e.user.email,c=e.user.nameRole;try{const e=await a.getSales();return t.render("ventasPanel",{venta:e,mensaje:r,nombreUser:o,apellidoUser:s,emailUser:i,rolUser:c})}catch(e){console.log(e)}}static async deleteSales(e,t){const{idSales:r}=e.params;try{return await a.deleteSales({idSales:r}),t.redirect("/ventas?mensaje=elimanada")}catch(e){console.log(e)}}}},1442:(e,t,r)=>{const{validationResult:a}=r(3553),o=r(2746);e.exports=class{static async addSuscriptor(e,t){const r=a(e),{email:s,texto:i}=e.body,c=e.body.names;if(console.log(e.body),!r.isEmpty())return t.status(400).json({error:r.array()});const n=c.split(" "),d=await o.addSuscripcion({nombresCompletos:n,email:s,texto:i});return console.log(d),"success"===d?t.json({succes:!0}):t.redirect("/contacto")}static async getSuscriptores(e,t){const r=e.user.firstName,a=e.user.lastName,s=e.user.email,i=e.user.nameRole;try{const e=await o.getSuscriptores();return t.render("suscriptoresPanel",{mensaje:"",user:e,nombreUser:r,apellidoUser:a,emailUser:s,rolUser:i})}catch(e){}}}},3642:(e,t,r)=>{const{validationResult:a}=r(3553),o=r(4863),s=r(7096),i=new class{async registerUser(e,t){const r=e.user.firstName,i=e.user.lastName,c=e.user.email,n=e.user.nameRole,d=a(e),{name:l,lastNames:u,email:p,password:g,role:m}=e.body,y=u.split(" "),P=s.hashSync(g,10),w=e.body;if(console.log(w),!d.isEmpty())return console.log(d.array()),t.render("registroUserPanel",{errors:d.array(),valuesBody:w,alertMensaje:"",nombreUser:r,apellidoUser:i,emailUser:c,rolUser:n});try{if("ER_DUP_ENTRY"===(await o.addUser({name:l,lastName:y,email:p,newPassword:P,role:m})).code){const e="existe";return t.render("registroUserPanel",{errors:[],valuesBody:w,alertMensaje:e,nombreUser:r,apellidoUser:i,emailUser:c,rolUser:n})}const e="registrado";return t.render("registroUserPanel",{errors:[],valuesBody:"",alertMensaje:e,nombreUser:r,apellidoUser:i,emailUser:c,rolUser:n})}catch(e){console.log(e)}}async getUserPanel(e,t){const r=e.user.firstName,a=e.user.lastName,s=e.user.email,i=e.user.nameRole,c=e.query.mensaje;try{const e=await o.getUser();return t.render("usuarios",{user:e,mensaje:c,nombreUser:r,apellidoUser:a,emailUser:s,rolUser:i})}catch(e){}}getUserPanelForm(e,t){const r=e.user.firstName,a=e.user.lastName,o=e.user.email,s=e.user.nameRole;return t.render("registroUserPanel",{valuesBody:"",errors:[],alertMensaje:"",nombreUser:r,apellidoUser:a,emailUser:o,rolUser:s})}async deleteUserPanel(e,t){const{idPerson:r}=e.params;try{return 1==(await o.deleteUser({idPerson:r})).affectedRows?t.redirect("/user?mensaje=borrado"):t.redirect("/user")}catch(e){console.log(e)}}};e.exports=i},6172:(e,t,r)=>{const{body:a}=r(3553);e.exports={loginValidator:function(){return[a("email","Email invalido").isEmail(),a("password","contraseÃ±a invalida").notEmpty()]}}},6924:(e,t,r)=>{const{body:a}=r(3553);e.exports=function(){return[a("categoria","Categoria invalido").matches(/^[a-zA-Z\s]+$/),a("image").custom(((e,{req:t})=>{if(!t.file)throw new Error("archivo invalido");return!0}))]}},9512:(e,t,r)=>{const{body:a}=r(3553);e.exports=function(){return[a("nombre","nombre invalido").matches(/^[a-zA-Z\s]+$/),a("apellidos","apellidos invalido").matches(/^[a-zA-Z\s]+$/),a("celular","celular invalido").isNumeric(),a("Ciudad","ciudad invalido").matches(/^[a-zA-Z\s]+$/),a("direccion").custom((e=>{if(e&&!/^[a-zA-Z0-9\s.,Â°]+$/.test(e))throw new Error("Dreccion  invÃ¡lido: calle nÂ° 12");return!0}))]}},5967:(e,t,r)=>{const{body:a}=r(3553);e.exports=function(){return[a("nombre").matches(/^[a-zA-Z\s]+$/),a("descripcion").custom((e=>{if(e&&!/^[a-zA-Z0-9\s.,]+$/.test(e))throw new Error("Texto invÃ¡lido: solo se permiten letras, nÃºmeros, puntos, comas y espacios");return!0})),a("imagenes").custom(((e,{req:t})=>{if(!t.files||0===t.files.length)throw new Error("Archivo invalido");return!0})),a("cantidad").isNumeric(),a("precio").notEmpty().isNumeric(),a("tallas").matches(/^(?:[a-zA-Z\s]*)$/),a("colores").matches(/^[a-zA-Z\s]+$/)]}},7157:(e,t,r)=>{const{body:a}=r(3553);e.exports=function(){return[a("name","nombre invalido").matches(/^[a-zA-Z\s]+$/),a("lastNames","Apellidos invalido").matches(/^[a-zA-Z\s]+$/),a("email","email invalido").isEmail(),a("password","contraseÃ±a invalida")]}},9026:(e,t,r)=>{const{body:a}=r(3553);e.exports=function(){return[a("names","nombre invÃ¡lido").matches(/^[a-zA-Z\s]+$/),a("email","email invÃ¡lido").isEmail(),a("texto").optional().custom((e=>{if(e&&!/^[a-zA-Z0-9\s.,]+$/.test(e))throw new Error("Texto invÃ¡lido: solo se permiten letras, nÃºmeros, puntos, comas y espacios");return!0}))]}},7231:(e,t,r)=>{const{body:a}=r(3553);e.exports=function(){return[a("categoria").matches(/^[a-zA-Z\s]+$/)]}},9164:(e,t,r)=>{const{body:a}=r(3553);e.exports=function(){return[a("nombre").matches(/^[a-zA-Z\s]+$/),a("descripcion").matches(/^[a-zA-Z\s]+$/),a("cantidad").isNumeric(),a("precio").notEmpty().isNumeric(),a("tallas").matches(/^(?:[a-zA-Z\s]*)$/),a("colores").matches(/^[a-zA-Z\s]+$/)]}},8363:(e,t,r)=>{const a=r(9344),o=r(5698);e.exports=async function(e,t,r){const s=e.cookies.jwt;if(s){const i=a.verify(s,process.env.JWT_SECRET),[c]=await o.VerificaUsuarioRol(i.idUser);return c?(e.user=c,r()):t.redirect("/login")}return t.redirect("/login")}},1419:e=>{e.exports=function(e,t,r){const a=e.user.nameRole;return console.log(a),"admin"===a||"vendedor"===a?r():t.rediret("/login")}},7664:(e,t,r)=>{const a=r(1738),o=r(1017),s=a.diskStorage({destination:o.join(__dirname,"../public/upload"),filename:(e,t,r)=>r(null,(new Date).getTime()+o.extname(t.originalname))}),i=a({storage:s,dest:o.join(__dirname,"../public/upload"),fileFilter:(e,t,r)=>{const a=o.extname(t.originalname);return r(null,".png"==a||".jpg"==a||".jpeg"==a)}});e.exports=i},2457:(e,t,r)=>{const a=r(2418);r(5142).config();const o=a.createPool({database:process.env.DB_DATABASE,host:process.env.DB_HOST,user:process.env.DB_USER,password:process.env.BD_PASSWORD,port:process.env.DB_PORT,connectionLimit:20,waitForConnections:!0});e.exports=async function(){try{const e=await o.getConnection();return console.log("conectada a la base de datos"),e}catch(e){throw console.log("error en la conexion a la base de datos \n",e),e}}},8205:(e,t,r)=>{const a=r(2457);e.exports=class{static async Pedido({nombre:e,lastName:t,celular:r,Ciudad:o,direccion:s,product:i,orderP:c}){let n;console.log(c);try{n=await a(),await n.beginTransaction(),console.log("sola la base de datos");const[d]=await n.query("INSERT INTO Person(firstName, lastName, motherLastName,  dateRegister)VALUES(?,?,?,now())",[e,t[0],t[1]]);await n.query("INSERT INTO Contact(cell, city, address, idPerson) values(?,?,?,?)",[r,o,s,d.insertId]);const[l]=await n.query("INSERT INTO OrderCustomer(idPerson, stateOrder ,dateOrderHour)values(?,?,now())",[d.insertId,c.entrega]);for(let e of i.productUnique)await n.query("INSERT INTO ProductDetail(idProduct, idOrder, amount)values(?,?,?)",[e.idProduct,l.insertId,e.cantidad]);return n.commit(),"success"}catch(e){return n.rollback(),e}finally{n&&n.release()}}static async getAllOrder({state:e}){let t;try{t=await a();const[r]=await t.query("SELECT * FROM CustomerOrder WHERE state = ?",[e]);return r}catch(e){console.log(e)}finally{t&&t.release()}}static async productEntregado({idOrder:e,state:t}){let r;try{return r=await a(),void await r.query("UPDATE OrderCustomer  SET state = ? WHERE idOrder=?",[t,e])}catch(e){console.log(e)}finally{r&&r.release()}}static async deletePorductId({idPersonOrder:e}){let t;try{return t=await a(),void await t.query("DELETE FROM Person WHERE idPerson = ?",[e])}catch(e){console.log(e)}finally{t&&t.release()}}}},5698:(e,t,r)=>{const a=r(2457);e.exports=class{static async login({email:e}){let t;try{t=await a();const r="select * from VerifyUser where email=?",[o]=await t.query(r,[e]);return o}catch(e){console.log(e)}finally{t&&t.release()}}static async VerificaUsuarioRol(e){let t;try{t=await a();const r="select * from VerifyUser where idUser=?",[o]=await t.query(r,[e]);return o}catch(e){console.log(e)}finally{t&&t.release()}}}},2187:(e,t,r)=>{const a=r(2457);e.exports=class{static async cardProduct({productId:e}){let t;try{t=await a();const r=" SELECT * FROM ViewsProduct WHERE idProduct = ?",[o]=await t.query(r,[e]);return o}catch(e){console.log(e)}finally{t&&t.release()}}}},441:(e,t,r)=>{const a=r(2457);e.exports=class{static async addCategory(e,t,r){let o;try{o=await a();const s="INSERT INTO Category(nameCategory,image,imageId)values(?,?,?)",[i]=await o.query(s,[e,t,r]);return i}catch(e){return e}finally{o&&o.release()}}static async showCategory(){let e;try{e=await a();const t="SELECT * FROM Category",[r]=await e.query(t);return r}catch(e){console.log(e)}finally{e&&e.release()}}static async deleteCategory(e){let t;try{return t=await a(),void await t.query("DELETE FROM Category WHERE idCategory=?",[e])}catch(e){return e.code}finally{t&&t.release()}}static async getCategoryId(e){let t;try{t=await a();const[r]=await t.query("SELECT *  FROM Category WHERE idCategory=?",[e]);return r}catch(e){console.log(e)}finally{t&&t.release()}}static async updateCategory({categoria:e,idCategory:t}){let r;try{return r=await a(),void await r.query("UPDATE Category SET nameCategory=? WHERE idCategory=?",[e,t])}catch(e){console.log(e)}finally{r&&r.release()}}static async updateCategoryImage({idCategory:e,image:t,idImg:r}){let o;try{return o=await a(),void await o.query("UPDATE Category SET image=?, imageId=? WHERE idCategory=?",[t,r,e])}catch(e){console.log(e)}finally{o&&o.release()}}}},9418:(e,t,r)=>{const a=r(2457);e.exports=class{static async descriptionProduct({idProduct:e}){let t;try{t=await a();const r="select  Product.idProduct, product.nameProduct , Product.description, Product.color, Product.size, Product.price, ProductDate.image  from Product inner join ProductDate on Product.idProduct = ProductDate.idProduct where Product.idProduct=?",[o]=await t.query(r,[e]);return o}catch(e){console.log(e)}finally{t&&t.release()}}static async productDestacado(){let e;try{e=await a();const t="SELECT * FROM Outstanding where amount > 0",[r]=await e.query(t);return r}catch(e){console.log(e)}finally{e&&e.release()}}static async getProductCategory({nameProduct:e}){let t;try{t=await a();const[r]=await t.query("SELECT * FROM category"),[o]=await t.query("SELECT *  FROM ViewsProduct where nameCategory = ?",[e]);return{category:r,product:o}}catch(e){console.log(e)}finally{t&&t.release()}}static async addPorduct({nombre:e,descripcion:t,cantidad:r,precio:o,colores:s,tallas:i,pathImgCloud:c,categorias:n,destacado:d}){let l;try{l=await a(),await l.beginTransaction();const[u]=await l.query("INSERT INTO Product(nameProduct,description, amount, price,date,color,size,outstanding, idCategory)VALUES(?,?,?,?,now(),?,?,?,?)",[e,t,r,o,s,i,d,n]);for(let e of c)await l.query("INSERT INTO ProductDate(image,imagenId, idProduct)values(?,?,?)",[e.urlImg,e.idImg,u.insertId]);await l.commit()}catch(e){console.log(e),l.rollback()}finally{l&&l.release()}}static async getAllProduct(){let e;try{e=await a();const[t]=await e.query("SELECT * FROM ViewsProduct");return t}catch(e){console.log(e)}finally{e&&e.release()}}static async deleteProduct({idProduct:e}){let t;try{t=await a();const[r]=await t.query("SELECT imagenId FROM ProductDate WHERE idProduct=? ",[e]);return await t.query("DELETE FROM Product WHERE idProduct=?",[e]),r}catch(e){if("ER_ROW_IS_REFERENCED_2"===e.code)return 1451}finally{t&&t.release()}}static async getAllProductId({idProduct:e}){let t;try{t=await a();const[r]=await t.query("SELECT * FROM Product WHERE idProduct=?",[e]),[o]=await t.query("SELECT * FROM ProductDate WHERE idProduct =?",[r[0].idProduct]);return{productos:r,dataImgPro:o}}catch(e){console.log(e)}finally{t&&t.release()}}static async updateProduct({nombre:e,descripcion:t,cantidad:r,precio:o,colores:s,tallas:i,pathImgCloud:c,categorias:n,destacado:d,idProduct:l}){let u;try{return u=await a(),console.log("update"),void await u.query("UPDATE  Product SET nameProduct=?,description=?, amount=?, price=?,color=?,size=?,outstanding=?, idCategory=? WHERE idProduct=?",[e,t,r,o,s,i,d,n,l])}catch(e){console.log(e)}finally{u&&u.release()}}static async updateImage({pathImgCloud:e,idProduct:t}){let r;try{r=await a();const[o]=await r.query("SELECT idProductDate FROM ProductDate WHERE idProduct =?",[t]),s=o.map((e=>e.idProductDate));for(let a=0;a<e.length;a++){const o=e[a],i=s[a];await r.query("UPDATE ProductDate SET image=?,imagenId=? WHERE idProduct=? and idProductDate=?",[o.urlImage,o.idImg,t,i])}return}catch(e){console.log(e)}finally{r&&r.release()}}static async getImg({idProduct:e}){let t;try{t=await a();const[r]=await t.query("SELECT imagenId FROM ProductDate WHERE idProduct=? ",[e]);return r}catch(e){console.log(e)}finally{t&&t.release()}}}},8941:(e,t,r)=>{const a=r(2457);e.exports=class{static async getSales(){let e;try{e=await a();const[t]=await e.query("SELECT * FROM SalesProduct");return t}catch(e){console.log(e)}finally{e&&e.release()}}static async deleteSales({idSales:e}){let t;try{return t=await a(),void await t.query("DELETE FROM Person WHERE idPerson = ?",[e])}catch(e){console.log(e)}finally{t&&t.release()}}}},4863:(e,t,r)=>{const a=r(2457);e.exports=class{static async addUser({name:e,lastName:t,email:r,newPassword:o,role:s}){let i;try{i=await a(),await i.beginTransaction();const[c]=await i.query("INSERT INTO Person(firstName,lastName,motherLastName,dateRegister)VALUES(?,?,?,now())",[e,t[0],t[1]]),[n]=await i.query("INSERT INTO User(email,password,idPerson)VALUES(?,?,?)",[r,o,c.insertId]);return await i.query("INSERT INTO role(idUser,nameRole)VALUES(?,?)",[n.insertId,s]),i.commit(),"success"}catch(e){return i.rollback(),e}finally{i&&i.release()}}static async getUser(){let e;try{e=await a();const[t]=await e.query("SELECT * FROM VerifyUser");return t}catch(e){console.log(e)}finally{e&&e.release()}}static async deleteUser({idPerson:e}){let t;try{t=await a();const[r]=await t.query("DELETE FROM Person WHERE idPerson= ?",[e]);return r}catch(e){return e}finally{t&&t.release()}}}},2746:(e,t,r)=>{const a=r(2457);e.exports=class{static async addSuscripcion({nombresCompletos:e,email:t,texto:r}){let o;console.log(e[0]);try{o=await a(),o.beginTransaction();const[s]=await o.query("INSERT INTO Person(firstName,lastName ,motherLastName, dateRegister)values(?,?,?,now())",[e[0],e[1],e[2]]);return await o.query("INSERT INTO Suscriptor(Email, textArea, idPerson)Values(?,?,?)",[t,r,s.insertId]),o.commit(),"success"}catch(e){return o.rollback,e}finally{o&&o.release()}}static async getSuscriptores(){let e;try{e=await a();const[t]=await e.query("SELECT * FROM Suscriptos ");return t}catch(e){console.log(e)}finally{e&&e.release()}}}},2274:(e,t,r)=>{const a=r(6860),o=r(9512),s=r(6907),i=r(8363),c=r(1419),n=a.Router();n.get("/pedido",s.pedido),n.post("/pedido",[o()],s.pedidoFinal),n.get("/get-order",[i,c],s.getAllOrder),n.get("/vender/:idOrder",[i,c],s.stateOrder),n.get("/delete-pedido/:idPersonOrder",[i,c],s.deteleOrder),e.exports=n},1208:(e,t,r)=>{const a=r(6860),o=r(7485),{loginValidator:s}=r(6172),i=a.Router();i.post("/login",[s()],o.login),i.get("/login",o.formLogin),i.get("/logout",o.logout),e.exports=i},3e3:(e,t,r)=>{const a=r(6860),o=r(5663),s=a.Router();s.get("/add-cart/:idCart",o.addCart),s.get("/cart",o.cart),s.get("/cart/:idProduct",o.deleteCartProduct),e.exports=s},7738:(e,t,r)=>{const a=r(6860),o=r(386),s=r(7664),i=r(6924),c=r(7231),n=r(8363),d=r(1419),l=a.Router();l.get("/products/:nameProduct",o.showProduct),l.get("/update-category/:idCategory",[n,d],o.updateCategoryForm),l.post("/update-category/:idCategory",[n,d,s.single("images"),c()],o.updateCategory),l.get("/delete-category/:idCategory/:idImagen",[n,d],o.deleteCategory),l.post("/add-category",[n,d,s.single("images"),i()],o.addCategory),e.exports=l},2357:(e,t,r)=>{const a=r(6860),o=r(7400),s=a.Router();s.get("/contacto",o.contacto),e.exports=s},1810:(e,t,r)=>{const a=r(6860),o=r(348),s=a.Router();s.get("/index",o.index),s.get("/",o.portadaIndex),s.get("/cant-cart",o.cartCantidad),e.exports=s},7598:(e,t,r)=>{const a=r(6860),o=r(4012),s=a.Router();s.get("/nosotros",o.nosotros),e.exports=s},4162:(e,t,r)=>{const a=r(6860),o=r(9202),s=r(386),i=r(3894),c=r(5967),n=r(8363),d=r(1419),l=a.Router();l.get("/products-panel",[n,d,c()],((e,t)=>{o.getProductAllPanel(e,t)})),l.get("/category-panel",[n,d],s.categoryPanel),l.get("/administration-panel",[n,d],i.Administration),e.exports=l},5526:(e,t,r)=>{const a=r(6860),o=r(7664),s=r(5967),i=r(9202),c=r(9164),n=r(8363),d=r(1419),l=a.Router();l.post("/add-product",[n,d,o.array("imagenes"),s()],i.addProduct),l.get("/add-product",[n,d],i.formProduct),l.get("/decription/:idProduct",((e,t)=>{i.descriptionProduct(e,t)})),l.get("/delete-product/:idProduct",[n,d],i.deleteProduct),l.get("/update-product/:idProduct",[n,d],i.formUpdateProdcut),l.post("/update-product/:idProduct",[n,d,o.array("imagenes"),c()],i.updateProduct),e.exports=l},3767:(e,t,r)=>{const a=r(6860),o=r(1468),s=r(8363),i=r(1419),c=a.Router();c.get("/ventas",[s,i],o.getSales),c.get("/delete-sales/:idSales",[s,i],o.deleteSales),e.exports=c},8011:(e,t,r)=>{const a=r(6860),o=r(1442),s=r(9026),i=r(8363),c=r(1419),n=a.Router();n.post("/suscribirse",[s()],o.addSuscriptor),n.get("/suscriptores",[i,c],o.getSuscriptores),e.exports=n},2373:(e,t,r)=>{const a=r(6860),o=r(3642),s=r(7157),i=r(8363),c=r(1419),n=a.Router();n.post("/register",[i,c,s()],o.registerUser),n.get("/user",[i,c],o.getUserPanel),n.get("/register",[i,c],o.getUserPanelForm),n.get("/register-delete/:idPerson",[i,c],o.deleteUserPanel),e.exports=n},7096:e=>{"use strict";e.exports=require("bcrypt")},3518:e=>{"use strict";e.exports=require("cloudinary")},9710:e=>{"use strict";e.exports=require("cookie-parser")},5142:e=>{"use strict";e.exports=require("dotenv")},6860:e=>{"use strict";e.exports=require("express")},6508:e=>{"use strict";e.exports=require("express-session")},3553:e=>{"use strict";e.exports=require("express-validator")},9344:e=>{"use strict";e.exports=require("jsonwebtoken")},9470:e=>{"use strict";e.exports=require("morgan")},1738:e=>{"use strict";e.exports=require("multer")},2418:e=>{"use strict";e.exports=require("mysql2/promise")},7147:e=>{"use strict";e.exports=require("fs")},1017:e=>{"use strict";e.exports=require("path")},3837:e=>{"use strict";e.exports=require("util")}},t={};function r(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,r),s.exports}(()=>{const e=r(1160);!async function(){const t=new e(process.env.PORT);await t.start()}()})()})();